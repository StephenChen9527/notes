# 对象的组合

## 设计线程的安全的类

在设计线程安全类的过程中，需要包含以下三个基本要素：
* 找出构成对象的所有变量。
* 找出约束状态变量的不可变性条件。
* 建立对象状态的并发访问管理策略。

##### 收集同步需求

如果在一个不变性条件中包含多个变量，那么在执行任何访问相关变量的操作时，都必须持有保护这些变量的锁。

##### 依赖状态的操作

类的不变性条件与后验条件约束了在对象上有哪些状态和状态转换是有效的。

如果在某个操作中包含有基于状态的先验条件，那么这个操作成为依赖状态的操作。

##### 状态的所有权

所有权与封装性总是相互关联的：对象封装它拥有的状态，反之也成立，即对它封装的状态拥有所有权。

## 实例封闭

将数据封装在对象内部，可以将数据的访问限制在对象的方法上，从而更容易确保线程在访问数据时总能持有正确的锁。

`Collections.synchornizedXX`方法，可以将非线程安全的容器转化为线程安全的容器，主要是使用了装饰器模式，包装器将容器封装到一个同步的容器中，然后将所有的调用操作再转发到底层的容器上，实现了线程安全。

如果一个本该被封闭的对象发布出去，那么也能破坏封闭性。

当发布其他对象，如：迭代器或者内部的类实例，可能会间接地发布被封闭的对象，同样会使被封闭的对象逸出。

封闭机制更易于构造线程安全的类，因为当封闭类的状态时，在分析类的线程安全性时就无需检查整个程序。

##### java监视器模式

##### 车辆追踪

将可变数据复制返回给客户端来保证线程安全性。

## 线程安全性的委托
