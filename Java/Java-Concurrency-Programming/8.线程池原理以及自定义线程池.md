# 8.线程池原理以及自定义线程池
Thread是一个重量级的资源，创建、启动、销毁都比较耗费系统资源。
## 线程池原理
所谓线程池，就是有一个池子，里面存放着已经创建好的线程，当有任务提交给线程池执行时，池子中的某个线程就会主动执行该任务。

一个完整的线程池应该具备如下要素：
* 任务队列：用于缓存提交的任务
* 线程数量管理功能：一个线程池必须能够很好地管理和控制线程数量，可通过如下三个参数来实现，比如创建线程池初始的线程数量init;线程池自动扩充时最大的线程数量max;在线程池空闲时候需要释放但是也要维护一定活跃数量或者核心数量core。 init<=core<=max
* 任务拒绝策略：如果线程数量已经达到上限且任务队列已满，则需要有响应的拒绝策略来通知任务提交者
* 线程工厂：主要用于个性化定制线程，比如将线程设置为守护线程以及设置线程名称
* QueueSize：任务队列主要存放提交的Runnable，但是为了防止内存溢出，需要有limit数量对其进行控制
* Keepedalive时间：该时间主要决定线程各个重要参数自动维护的时间间隔。

![线程池原理图](https://tva2.sinaimg.cn/large/005VwC5mly1g8pqxj1yt4j30lf08wdje.jpg)


## 线程池实现

主要入口就是`BasicThreadPool`，new 出来一个新的 pool，然后传入对应的`Runnable`子类即可。

初始化线程个数，然后封装了一个`InternalTask`类，这个类持有`任务队列`，这个类时`Runnable`的子类，具体的run方法就是一直监控任务队列中的任务，如果任务队列中其他`Runnable`对象，如果有任务来了，就执行对应的`run`方法。

放入`pool`中并不是直接运行，而是先放入线程任务队列中，如果队列达到了最大值，则可以进行一个拒绝策略：直接放弃、抛出异常等。

其实线程池的线程主要的作用就是监控任务队列，来了任务就执行对应的run方法（之前一直以为是线程池也要把runnable对象放到线程池中，线程池会创建thread类进行执行start，那这个池的作用感觉跟直接启动没区别。今天看了一遍，原来是我想的问题。）

## 线程池的应用
test了上面的代码

还不如了解下java并发包的线程池。

## 总结
这章节真的蛋疼，代码写的还乱...
