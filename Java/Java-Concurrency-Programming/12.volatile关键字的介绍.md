# 12.volatile关键字

## 初识volatile关键字
代码详见书。

volatile关键字只能修饰类变量与实例变量，对于方法参数、局部变量以及实例常量，类常量都不能进行修饰（常量又不能改，及时能修饰也没有什么意义...局部变量与方法参数更是不会有并发的情况。。）。

## 机器硬件CPU

在计算机中，所有的运算操作都是由CPU的寄存器来完成的，CPU指令的执行过程需要涉及数据的读取和写入操作，CPU所能访问的所有数据只能是计算机的主存（RAM）

#### CPU Cache模型

CPU的缓存现在可以增加到3级，最靠近CPU的为L1，然后依次是L2，L3。

L1又分为L1i(instruction)，L1d(data)，这两种有各自专门用途的缓存。


CPU Cache又是多个Cache Line构成的，Cache Line可认为是CPU Cache中的最小缓存单位（Line 又是什么玩意... 是L1 L2 L3?）。

目前Cache Line大小都是64字节的。

![Cache模型](https://tvax3.sinaimg.cn/large/005VwC5mly1g9adsdjaw3j30iz09ctfk.jpg)

![CPU访问速率对比](https://tva3.sinaimg.cn/large/005VwC5mly1g9aduabjcuj30op0d6wjr.jpg)

可以从上面看出来，CPU访问L1主内存的速度都相比L1,慢很多。。。

Cache的出现主要是为了解决CPU直接访问内存效率低下问题，在程序运行过程中，会将运算所需要的数据从主内存复制一份到CPU Cache中，这样CPU计算时就可以直接怼CPU Cache中的数据进行读取和写入，当运算结束的时候，直接将CPU Cache中的最新数据刷新到主内存中。

![CPU、CPU Line、主内存](https://tva2.sinaimg.cn/large/005VwC5mly1g9ael4bzkfj30ej088jv5.jpg)

#### CPU缓存一致性问题

引入缓存，极大地提高了CPU的吞吐能力，但是同时也引入了缓存不一致的问题，比如i++：

1. 读取主内存的i到CPU Cache中
2.
